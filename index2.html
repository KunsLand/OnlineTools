<!DOCTYPE HTML>
<html>
<head>
	<title>Online Tools</title>
	<style>
		body {
			width: 1080px;
		}
		th {text-align: right;}
	</style>
</head>
<body>
	<div id="local">
	    <h2>
	        File Hash Online
	    </h2>
	    <input type="file" id="localFile" name="localFile"/>
	 </div>
	<div>
	    <h2>Result</h2>
	    <table id="result">
	    </table>
	</div>
	<script type="text/javascript">
		function readFileInfo(evt){
  			evt.stopPropagation();
  			evt.preventDefault();
			File.prototype.slice = File.prototype.webkitSlice || File.prototype.mozSlice || File.prototype.slice;
		    var file = event.dataTransfer ? event.dataTransfer.files[0] : event.target.files[0];
		    var chunkSize = 1048576, // read in chunks of 1MB
		    	chunks = Math.ceil(file.size / chunkSize),
		    	currentChunk = 0;
		    var worker = new Worker('worker.js');
		    worker.addEventListener('message',function(e){
		    	if(e.data.result){
		    		document.getElementById('result').innerHTML=e.data.result;
		    	}else{
		    		document.getElementById('result').innerHTML=e.data.chunk +'/' +chunks;
		    	}
		    });
		    frOnload=function(e){
		    	var blob = e.target.result;
		    	var msg = {'blob': blob,'chunk': ++currentChunk,'chunks': chunks};
		        worker.postMessage(msg);
		        e = null;
		        blob = null;
		        msg = null;
		        if (currentChunk < chunks) loadNext();
		    }

			function loadNext() {
				var fileReader = new FileReader();
				fileReader.onload = frOnload;
				var start = currentChunk * chunkSize,
					end = ((start + chunkSize) >= file.size) ? file.size : start + chunkSize;
				fileReader.readAsArrayBuffer(file.slice(start, end));
			};
			loadNext();
		}
		document.getElementById('localFile').addEventListener('change',readFileInfo);
	</script>
</body>
</html>
